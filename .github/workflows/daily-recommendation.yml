name: Daily Game Recommendation

on:
  schedule:
    # Runs at 09:00 UTC everyday (12:00 TRT)
    - cron: "0 9 * * *"
  workflow_dispatch: # Allows manual trigger from GitHub UI

jobs:
  recommend-game:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"
          cache: "npm"

      - name: Install Dependencies
        run: npm ci

      - name: Run Recommendation Bot
        env:
          RAWG_API_KEY: ${{ secrets.RAWG_API_KEY }}
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        run: npx ts-node src/index.ts

      - name: Commit History Update
        # Commits the updated history.json back to the repo so we don't recommend the same game again
        run: |
          git config --global user.name 'GameBot'
          git config --global user.email 'bot@noreply.github.com'
          git add data/history.json
          git commit -m "Update game history [skip ci]" || echo "No changes to commit"
          git push
